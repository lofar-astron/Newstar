<HEAD>
<TITLE>No Title</TITLE>
</HEAD>
<BODY><P>
 <b>NCALIB REDUN: Redundancy, Align and Selfcal</b> <A NAME=.contents><IMG ALIGN=MIDDLE SRC="../icons/invis_anchor.png"></A>
<P><H2><A NAME=SECTION0001000000000000000>Contents</A></H2>
<UL> 
<LI> <A NAME=tex2html1 HREF=ncalib_redun.html#SECTION0001000000000000000>Contents</A>
<LI> <A NAME=tex2html2 HREF=ncalib_redun.html#SECTION0002000000000000000> <b>Overview</b></A>
<LI> <A NAME=tex2html3 HREF=ncalib_redun.html#SECTION0003000000000000000> <b>Redundancy</b></A>
<LI> <A NAME=tex2html4 HREF=ncalib_redun.html#SECTION0004000000000000000> <b>Align</b></A>
<LI> <A NAME=tex2html5 HREF=ncalib_redun.html#SECTION0005000000000000000> <b>Selfcal</b></A>
<LI> <A NAME=tex2html6 HREF=ncalib_redun.html#SECTION0006000000000000000> <b>Discussion of the screen/log output</b></A>
<LI> <A NAME=tex2html7 HREF=ncalib_redun.html#SECTION0007000000000000000> <b>QDETAILS: Hidden parameters</b></A>
</UL>
<H1><A NAME=SECTION0002000000000000000> <b>Overview</b></A></H1>
<P>
        The NCALIB option <b>REDUN</b> actually covers three related methods of estimating telescope gain and phase errors from the uv-data itself: Redundancy, Selfcal and Align. All three methods require the socalled `Selfcal assumption', which states that all phase and gain errors are <em>telescope-based</em>.    
 This means that the errors can be fully decomposed into contributions from individual telescopes, and that interferometer-based errors can be ignored. This assumption implies a drastic reduction in the number of <em>independent</em> errors in the data taken with an N-telescope array: from <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap348.png"> to <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap350.png"> per integration interval.  This relatively small number of independent errors can be determined with a <em>least-squares fitting</em> technique.   
        Any <em>interferometer-based</em> errors (e.g.  thermal noise or correlator errors) violate the basic Selfcal assumption, and cause propagating errors in the solution.  Fortunately, the WSRT correlators only contribute very 
small interferometer errors (typically <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap352.png">0.01%),   
but the S/N per uv-sample should be at least 2-5 for a good solution.
<P>
        Independent solutions can be obtained for telescope gain and phase errors, because they are mathematically `orthogonal'.
<P>
<UL><LI> <b>Selfcal:</b>   
        The telescope gain and phase errors are estimated by comparing the uv-data with a model of the observed source.  In WSRT Selfcal, the information from redundant spacings can be added as <em>extra constraints</em> on the Selfcal solution.  Since this extra information is model-independent, the Selfcal process is less likely to converge to the wrong result.
<P>
<LI> <b>Redundancy:</b>   
        Telescope gain and phase errors are estimated by comparing the uv-data of `redundant' interferometers, i.e.  interferometers that have the same baseline length and orientation.  Since this is a comparative method, the absolute gain (flux) and the absolute phase gradient (position) cannot be determined.  The result is a set of `internally perfect' HA-scans, that still have to be `aligned' (see below) to each other in flux and position.
<P>
<LI> <b>Align:</b>   
        The absolute gain and the absolute phase gradient for misaligned HA-scans can be determined with the help of a source model.  This is similar to Selfcal, except that one only solves for one parameter per HA-scan, rather than for N telescope errors.  This has the advantage that the source model may be less perfect, and the SNR of the uv-data may be lower.  Therefore, this method may also be used to remove ionosferic phase gradients from data that have too little SNR to warrant Redundancy or Selfcal.
<P>
</UL>
<P>
        The figures of this section may help to illustrate the effects of these three methods.  There is also a description of the relevant mathematical formalism.  Finally, this section contains processing examples and an explanation of the output that is produced on the screen and in the log file.
<P>
<A NAME=.ncalib.3c48><IMG ALIGN=MIDDLE SRC="../icons/invis_anchor.png"></A> 
<A HREF="../fig/ncalib_3c48.ps"><STRONG>FIGURE</STRONG></A>
<P>
 .]<i>Principal features of the Selfcal, Redundancy and Align methods. 
<BR><BR>These four maps of 3C48 may serve to demonstrate the main features of the three methods: 
<BR><BR>The <em>radial stripes</em> in (a) are caused by large-scale effects at specific Hour Angles. These limit the dynamic range of the 'Standard Reduction' to about 1:100 (20 dB). They are still present after a Redundancy solution, but can be be removed with an Align. 
<BR><BR>The <em>prominent rings</em> in (b) are caused by a slowly varying gain or phase errors between telescopes A and B. They could be removed by Redundancy, but only if there is a full solution for all 14 telescopes. Otherwise they can be removed with Align or Selfcal. 
<BR><BR>The <em>almost perfect map</em> in (c) is the result of Selfcal, without Redundancy. The minor remaining problems are caused by the incompleteness of the source model, particularly the small source near 3C48. 
<BR><BR>The <em>finished product</em> in (d) is essentially perfect, and has a dynamic range in excess of 1:10000 (40 dB), limited by the noise only. The remaining rings are the grating rings of sources which have not been completely subtracted. The result has been produced by a full Redundancy solution, followed by an Align with a model that contained about 10 point sources. 
(and Reduction very low </i>
<P>
<A NAME=.ncalib.scan><IMG ALIGN=MIDDLE SRC="../icons/invis_anchor.png"></A> 
<A HREF="../fig/ncalib_scan.ps"><STRONG>FIGURE</STRONG></A>
<P>
 .]<i>The effects of Redundancy, Selfcal and Align on the visibilities in a single HA-scan.  
<BR><BR>In all four pictures, the broken line represents the `true' visibility amplitudes and phases, as a function of baseline length (u).  The actual uv-data are given by crosses.  Note the multiple uv-data for redundant baselines.  The source model in this example (full line) is an off-axis point source.  
<BR><BR><b>Redundancy</b>: In (a), he actually measured uv-samples are scattered, because of instrumental errors.  After Redundancy calibration (b), the amplitudes and phases of redundant baselines are the same (except for a little residual scatter caused by noise).  The result is an `internally perfect HA-scan', i.e.  its shape is as it should be, but two parameters are still missing: the absolute flux and the absolute position in the sky.  A map made in this stage would show radial stripes around strong sources.  
<BR><BR><b>Align</b>: In (c), the perfect HA-scans that are produced by Redundancy are `Aligned' with the help of a model of the observed source.  The `rigid' Scans are moved as a whole to fit the model in a <em>weighted least-squares</em> sense.  Arrows indicate the two parameters that are determined by Align: one to shift all amplitudes vertically, and one to rotate all phases around the origin.  Note that the outcome can be influenced by giving more weight to certain baselines.  
<BR><BR><b>Selfcal</b>: In `normal' Selfcal (d), the source model is used to determine <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap354.png"> telescope gain and phase errors.  Since this number of independent parameters is larger than the two that were needed for Align, the Scan is less `rigid'.  This means that the data have greater freedom to adapt themselves to the <em>wrong</em> source model.  
<BR><BR>To counter this effect, Redundancy constraints can be added to the Selfcal solution In the <i>NEWSTAR </i> implementation.  If the Redundancy constraints would be given infinite weight, the outcome would be identical to that of Redundancy followed by Align.  However, this has the disadvantage that a Redundancy solution may have `frozen-in' errors caused by noise in certain critical baselines.  Such errors may be `thawed out' by giving more weight to Selfcal (model) constraints.  In the present implementation, Selfcal and Redundancy constraints have equal weights, which may be close to optimum.  </i>
<P>
<A NAME=.ncalib.matrix><IMG ALIGN=MIDDLE SRC="../icons/invis_anchor.png"></A> 
<A HREF="../fig/ncalib_matrix.ps"><STRONG>FIGURE</STRONG></A>
<P>
 .]<i>Least-squares fit of telescope errors through matrix inversion. 
<BR><BR>The <b>problem</b> is formulated by the matrix equation 
        <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap356.png"> in which <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap358.png"> is a vector of known values, and <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap360.png"> is a vector of unkown telescope errors. Each row (equation) in the matrix is multiplied by a weight factor, which determines its relative influence on the solution. The same matrix can contain a mixture of Selfcal equations and Redundancy equations, both of which have the same general form. If there are only Redundancy equations, extra constraint equations are needed to supply the missing information about the absolute gain (flux) and/or the absolute phase gradient over the array (position in the sky). 
<BR><BR>The matrix <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap364.png"> is rectangular because there are more equations than unknowns. A least-squares <b>solution</b> is obtained by the pseudo-inversion of <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap364.png">: 
<BR><BR><IMG ALIGN=BOTTOM ALT="" SRC="_24705_tex2html_wrap385.png"> 
<BR><BR>To save space and time, the <i>NEWSTAR </i> implementation uses the much smaller matrix <IMG ALIGN=BOTTOM ALT="" SRC="_24705_tex2html_wrap387.png"> and the vector <IMG ALIGN=BOTTOM ALT="" SRC="_24705_tex2html_wrap389.png">, which is of course mathematically equivalent. </i>
<P>
<A NAME=.ncalib.vispace><IMG ALIGN=MIDDLE SRC="../icons/invis_anchor.png"></A> 
<A HREF="../fig/ncalib_vispace.ps"><STRONG>FIGURE</STRONG></A>
<P>
 .] A qualitative interpretation of Selfcal, with or without Redundancy constraints. 
<BR><BR>A perfect instrument would give visibility values that are represented by a point (the <em>true</em> visibilities) in a 2N-dimensional <em>visibility space</em>. N is the number of measured uv-samples. The actual visibility values, which will be corrupted by instrumental errors, are represented by some other point in this space. 
<BR><BR>In a calibration process, a priori knowledge is used to constrain the volume of visibility space in which this other point can lie.  In Selfcal, the data are compared with a model of the source (model constraints), under the assumption that the only instrumental errors are telescope-based gain and phase errors (instrumental constraints).  The points in visibility space that represent Selfcal Solutions must lie in the shaded volume that is bounded by the <em>model</em> and <em>Selfcal</em> constraints. The technique works because the two constraint volumes are largely 'orthogonal' to each other, so that the intersection volume is relatively small.  Every extra constraint (more telescopes, redundant spacings) will make this intersection volume smaller. 
<P>
<A NAME=.redundancy><IMG ALIGN=MIDDLE SRC="../icons/invis_anchor.png"></A>   
<H1><A NAME=SECTION0003000000000000000> <b>Redundancy</b></A></H1>
<P>
        Redundancy-only is selected by <b>not</b> specifying a source model. The resulting telescope gain and phase errors are stored in the Scan file headers, as REDC.
<P>
**** Put new script here ****
<P>
<A NAME=.align><IMG ALIGN=MIDDLE SRC="../icons/invis_anchor.png"></A>   
<H1><A NAME=SECTION0004000000000000000> <b>Align</b></A></H1>
<P>
        Align is selected by specifying a source model, and explicitly specifying the <b>ALIGN_OPTION</b>.  It is then assumed by default that the Scan is `perfect', i.e.  that all 14 telescopes are grouped together.  In that case, only two parameters have to be determined: the absolute gain, and the absolute phase gradient over the array. Experienced users can specify multi-parameter solutions for more than one independent groups of telescopes by manipulating the <b>FORCE_FREEDOM</b> keyword.  The <b>MWEIGHT</b> keywords are used to give greater weight to those baselines (by length), for which the model is `known' to be most accurate.
<P>
        The resulting telescope gain and phase corrections are stored in the Scan headers, as ALGC.
<P>
*** Put new script here ****
<P>
<A NAME=.selfcal><IMG ALIGN=MIDDLE SRC="../icons/invis_anchor.png"></A>   
<H1><A NAME=SECTION0005000000000000000> <b>Selfcal</b></A></H1>
<P>
        Selfcal is selected by specifying a source model, and explicitly specifying `Selfcal' to the <b>ALIGN_OPTION</b>.  Redundancy constraints (equations) are included automatically if redundant spacings have been selected with <b>SELECT_IFRS</b>.  The <b>MWEIGHT</b> keywords are used to give greater weight to those baselines (by length), for which the model is `known' to be most accurate.
<P>
        The resulting telescope gain and phase corrections are stored in the Scan headers, as ALGC.
<P>
*** Put new script here ****
<P>
<A NAME=.log.output><IMG ALIGN=MIDDLE SRC="../icons/invis_anchor.png"></A>   
<H1><A NAME=SECTION0006000000000000000> <b>Discussion of the screen/log output</b></A></H1>
<P>
The following information per HA-scan may be printed in the LOG-file and/or displayed on the terminal screen (keyword <b>SHOW_LEVEL</b>).
<P>
		<BR><tt>HA    Rk  A(%) P(deg) A(WU)  P(WU) Amax    Aavg   Arms    dAmax   
dPmax  I</tt>
<P>
		<BR><tt>Set: 0.0.0.0</tt>
<P>
		<BR><tt>11.53X New phase constraints:</tt>
<P>
		<BR><tt>1   1   1   1   1   1   1   1   1   1   1   1   1   1</tt>
<P>
		<BR><tt>11.53X 01   0.6   0.2   12.9    7.1  2012  2000.0   5.2    1.9 67 0.5 58 3</tt>
<P>
		 <BR><IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap372.png">
<P>
<P><IMG ALIGN=BOTTOM ALT="" SRC="_9871_tabbing169.png"><P>
<P>
		<BR><tt>X average amplitude= 2000.005 (0.892)</tt>
<P>
		<BR><tt>X overall noise (gain, phase in W.U.):     14.2     11.1</tt>
<P>
<UL><LI>   <b>Average amplitude:</b>
<P>
<LI>   <b>Average gain and phase errors per telescope:</b>   
        Over the whole observation (or rather, the part that has just been processed). These numbers can also be calculated separately by means of NCALIB option SHOW.
<P>
<LI>   <b>Overall noise:</b>   
        Useful for automatic deletion of `bad' scans (see NSCAN). Redundancy-only is model-independent, so the overall noise should be equal to the thermal noise. If not, it is an indication of problems. A difference between SELFCAL noise and Redundancy-only noise is an  indication of the completeness of the SELFCAL model (caution: there are different interferometers involved).
<P>
<LI>   <b>Graphs:</b>   
        There are three kinds of line-printer graphs produced in the log-file. They give various overall gain and phase quantities per interferometer. The baseline length increases to the right. The gain axis (A) is on the left, and the phase axis (P) on the right.   
  <UL><LI> <b>Graph: Average residual error X (W.U.):</b>   
  <LI> <b>Graph: Average residual error X (%, deg):</b>   
  <LI> <b>Graph: RMS X (W.U.):</b>   
  </UL> </UL>
<P>
        The SELFCAL and Redundancy residuals contain a wealth of information about the quality of the data and the completeness of the SELFCAL model. The user is urged to make residual plots by means of the program NPLOT.
<P>
<A NAME=.qdetails><IMG ALIGN=MIDDLE SRC="../icons/invis_anchor.png"></A>   
<H1><A NAME=SECTION0007000000000000000> <b>QDETAILS: Hidden parameters</b></A></H1>
<P>
        For all REDUN options, the user is prompted for `more details?' by the NCALIB keyword QDETAILS.  Hidden behind this are a number of keywords that may be manipulated by experienced users in special cases. Their default values are optimised for normal use, and wil be printed in the NCALIB LOG-file.
<P>
<BR><IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap410.png"> <b>BASEL_CHECK</b>   
 (M)   
 = 0.5 M:   
 <IMG ALIGN=BOTTOM ALT="" SRC="_19828_tex2html_wrap439.png">   
<BR><i>Criterion for two baselines to be considered redundant, i.e. of identical length.</i>
<P>
<BR><IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap410.png"> <b>WEIGHT_MIN</b>   
 (Minimum weight accepted)   
 = 0.01:   
 <IMG ALIGN=BOTTOM ALT="" SRC="_19828_tex2html_wrap441.png">   
<BR><i>The weight of Selfcal and Redundancy equations is proportional to the amplitude of their uv-data. If the amplitude is very small, the information will be very noisy, and may do more harm than good to the solution. Therefore, it may be excluded by raising the value of WEIGHT_MIN, as a fraction of the maximum weight.</i>
<P>
<BR><IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap410.png"> <b>SOLVE</b>   
 (Solve for gain, phase (Y/N)   
 = YES,YES:   
 <IMG ALIGN=BOTTOM ALT="" SRC="_19828_tex2html_wrap443.png">   
<BR><i>Normally, both a gain and a phase solution will be required. But it is possible to ask for only one at a time.</i>
<P>
<BR><IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap410.png"> <b>COMPLEX</b>   
 (Complex solution (Y/N)   
 = NO:   
 <IMG ALIGN=BOTTOM ALT="" SRC="_19828_tex2html_wrap445.png">   
<BR><i>The non-linear conversion to gain and phase skews the gaussian distribution of the noise on the measured cos/sine values. Therefore, gain and phase solutions will produce a `noise bias', which is more serious for low S/N data. This can be avoided by specifying a `complex solution' (see also section   
...)</i>
<P>
<BR><IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap410.png"> <b>FORCE_PHASE</b>   
 ()   
 = 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0    
 <IMG ALIGN=BOTTOM ALT="" SRC="_19828_tex2html_wrap447.png">   
<BR><i>If the visibility phases are close to <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap404.png">, the conversion from cos/sine to phase may cause phase ambiguities (jumps) of 360 degr. This will cause problems in the phase solution, where the phases are assumed to be on a linear scale between <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap406.png">. In order to avoid this, the user may specify initial phase corrections for all telescopes, which will be used to move the data away from <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap404.png"> before processing. This is of course taken into account for the total correction afterwards.</i>
<P>
<BR><IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap410.png"> <b>CONTINUITY</b>   
 (Continuity in solution (Y/N)   
 = YES:   
 <IMG ALIGN=BOTTOM ALT="" SRC="_19828_tex2html_wrap449.png">   
<BR><i>Normally, the HA-scans are processed in HA-order. The gain and phase errors determined for the last Scan may be used to correct the data of the next Scan <em>before</em> processing. (This is of course taken into account for the total correction afterwards).  This approach is useful to keep phases away from <IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap404.png">, where they may cause unwanted phase-ambiguity problems.</i>
<P>
<BR><IMG ALIGN=BOTTOM ALT="" SRC="_9871_tex2html_wrap410.png"> <b>CHECKS</b>   
 (Maximum deviations)   
 = 5,5,3:   
 <IMG ALIGN=BOTTOM ALT="" SRC="_19828_tex2html_wrap451.png">   
<BR><i>The user may set some threshold values for an automatic check on the quality of the solution of each HA-scan. A warning will be issued in the log whenever the tresholds are exceeded. However, no further action is taken by the program!</i>
<P>

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

<P>.

</BODY> </HTML> 
<HR>

</BODY>
<P><ADDRESS>
newstar@nfra.nl
